import type { NextPage } from 'next'
import Head from 'next/head'
import { trpc } from '../utils/trpc'
import { signIn, signOut, useSession } from 'next-auth/react'
import { useRouter } from 'next/router'
import { Button } from '@nextui-org/react'
import UserInfo from '../components/user-info'

const Home: NextPage = () => {
  const router = useRouter()
  const { data: session, status } = useSession()
  const loading = status === 'loading'
  const hello = trpc.useQuery(['hello', { text: 'from tRPC' }])
  const exampleData = trpc.useQuery(['example'])
  const { invalidateQueries } = trpc.useContext()
  const createExample = trpc.useMutation('create-example', {
    onSuccess: () => invalidateQueries('example'),
  })

  return (
    <>
      <Head>
        <title>Create t3 App</title>
        <meta name="description" content="Generated by create t3 app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <UserInfo session={session} status={status} />
      <div className="flex flex-col items-center justify-center w-1/2 min-h-screen mx-auto">
        <div className="py-6 text-2xl">{hello.data ? <p>{hello.data.greeting}</p> : <p>Loading..</p>}</div>
        <div className="py-6 text-2xl">
          <p>Data from Prisma:</p>
          {exampleData.data ? (
            <div>
              {exampleData.data.length === 0 ? (
                <p className="text-2xl">No data available, create new!</p>
              ) : (
                exampleData.data.map(({ id }: any) => <p key={id}>{id}</p>)
              )}
            </div>
          ) : (
            <p>Loading...</p>
          )}
        </div>
        <Button onClick={() => createExample.mutate()}>Create New Example</Button>
        {!session && (
          <>
            <span>You are not signed in</span>
            <a
              href={`/api/auth/signin`}
              onClick={(e) => {
                e.preventDefault()
                signIn()
              }}
            >
              Sign in
            </a>
          </>
        )}
        {session?.user && <Button onPress={() => router.push('/dashboard')}>Go to dashboard</Button>}
      </div>
    </>
  )
}

export default Home
